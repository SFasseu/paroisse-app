<?php

// ══════════════════════════════════════════════════════════════════════════
// MODULE GESTION DES SACREMENTS — Paroisse Saint-Esprit de Bépanda
// Ajouter ces lignes dans routes/web.php APRÈS les routes existantes
// ══════════════════════════════════════════════════════════════════════════

use App\Http\Controllers\Sacrements\SacrementsController;
use App\Http\Controllers\Sacrements\NiveauFormationController;
use App\Http\Controllers\Sacrements\CoursController;
use App\Http\Controllers\Sacrements\ExamenController;
use App\Http\Controllers\Sacrements\GroupeCatecheseController;
use App\Http\Controllers\Sacrements\CatechisteController;
use App\Http\Controllers\Sacrements\CatechumeneController;
use App\Http\Controllers\Sacrements\ProgressionController;
use App\Http\Controllers\Sacrements\SacrementRecuController;

Route::prefix('sacrements')->name('sacrements.')->middleware('auth')->group(function () {

    // ── Dashboard ──
    Route::get('/', [SacrementsController::class, 'index'])->name('dashboard');

    // ── Niveaux de formation ──
    Route::resource('niveaux', NiveauFormationController::class);

    // ── Cours ──
    Route::resource('cours', CoursController::class);

    // ── Examens ──
    Route::resource('examens', ExamenController::class);
    Route::get('examens/{examen}/saisir-resultats', [ExamenController::class, 'saisirResultats'])->name('examens.saisir-resultats');
    Route::post('examens/{examen}/enregistrer-resultats', [ExamenController::class, 'enregistrerResultats'])->name('examens.enregistrer-resultats');

    // ── Groupes de catéchèse ──
    Route::resource('groupes', GroupeCatecheseController::class);

    // ── Catéchistes ──
    Route::resource('catechistes', CatechisteController::class);

    // ── Catéchumènes ──
    Route::resource('catechumenes', CatechumeneController::class);
    Route::get('catechumenes/{catechumene}/progression', [CatechumeneController::class, 'progression'])->name('catechumenes.progression');
    Route::patch('catechumenes/{catechumene}/changer-statut', [CatechumeneController::class, 'changerStatut'])->name('catechumenes.changer-statut');

    // ── Progressions par niveau ──
    Route::post('progressions', [ProgressionController::class, 'store'])->name('progressions.store');
    Route::put('progressions/{progression}', [ProgressionController::class, 'update'])->name('progressions.update');
    Route::patch('progressions/{progression}/valider', [ProgressionController::class, 'valider'])->name('progressions.valider');

    // ── Sacrements reçus ──
    Route::get('catechumenes/{catechumene}/sacrements', [SacrementRecuController::class, 'index'])->name('sacrements.index');
    Route::get('catechumenes/{catechumene}/sacrements/create', [SacrementRecuController::class, 'create'])->name('sacrements.create');
    Route::post('catechumenes/{catechumene}/sacrements', [SacrementRecuController::class, 'store'])->name('sacrements.store');
    Route::get('sacrements/{sacrement}/edit', [SacrementRecuController::class, 'edit'])->name('sacrements.edit');
    Route::put('sacrements/{sacrement}', [SacrementRecuController::class, 'update'])->name('sacrements.update');
    Route::delete('sacrements/{sacrement}', [SacrementRecuController::class, 'destroy'])->name('sacrements.destroy');

});
